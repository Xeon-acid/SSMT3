<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="SSMT.HomePage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:SSMT"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    xmlns:mmt_core_gridviewitems="using:SSMT"
    xmlns:community="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:s="using:CommunityToolkit.WinUI"
    xmlns:controls="using:CommunityToolkit.WinUI.Controls"
    xmlns:canvas="using:Microsoft.Graphics.Canvas.UI.Xaml"
    CacheMode="BitmapCache"
    Background="Transparent"
    >

    <Grid >
        <!-- 定义行 -->
        <Grid.RowDefinitions>
            <RowDefinition/>
        </Grid.RowDefinitions>

        <!-- 定义列 -->
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="0.7*"/>
            <ColumnDefinition Width="0.3*"/>
        </Grid.ColumnDefinitions>

        <!-- 背景视频 -->
        <MediaPlayerElement 
            x:Name="BackgroundVideo"
            Grid.ColumnSpan="2"
            Grid.RowSpan="2"
            AreTransportControlsEnabled="False"
            AutoPlay="False"
            IsHitTestVisible="False"
            Stretch="UniformToFill"
            Visibility="Collapsed" />

        <!-- 背景图片 -->
        <Image 
            HorizontalAlignment="Right"
            RenderTransformOrigin="0.5,0.5"
            Grid.ColumnSpan="2"
            Grid.RowSpan="2"
            x:Name="MainWindowImageBrush"  
            Stretch="UniformToFill" >
            <Image.RenderTransform>
                <ScaleTransform />
            </Image.RenderTransform>
        </Image>

        <!--游戏图标列表-->
        <GridView
            Margin="80,35"
            VerticalAlignment="Bottom"
            Grid.Column="0"
            Grid.Row="0"
            x:Name="GameIconGridView"
            ScrollViewer.VerticalScrollBarVisibility="Auto"
            MaxWidth="1000"
            SelectionChanged="GameIconGridView_SelectionChanged">

            <GridView.ItemTemplate >
                <DataTemplate x:Name="GameIconItemGridTemplate" x:DataType="local:GameIconItem" >
                    <GridViewItem >
                        <Grid x:Name="ModShowGrid" Width="80" Height="80" AllowDrop="False" >

                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>


                            <Image HorizontalAlignment="Left"   Grid.Row="0" Source="{x:Bind GameIconImage}" Stretch="UniformToFill" Width="80" Height="80"/>

                            <StackPanel Grid.Row="0" Orientation="Vertical" VerticalAlignment="Bottom" Height="20" >
                                <StackPanel.Background>
                                    <AcrylicBrush
                                        TintColor="{ThemeResource SystemChromeLowColor}"
                                        TintOpacity="0.7"
                                        FallbackColor="{ThemeResource SystemChromeLowColor}"/>
                                </StackPanel.Background>
                                <TextBlock 
                                    HorizontalAlignment="Center" Margin="1" VerticalAlignment="Bottom" Text="{x:Bind GameName}" FontSize="11" FontWeight="Bold"/>
                            </StackPanel>
                            <!-- 流光边框 -->
                            <Rectangle 
                                Grid.Row="0" 
                                Grid.RowSpan="2" 
                                x:Name="FlowBorder" 
                                RadiusX="8" 
                                RadiusY="8" 
                                StrokeThickness="2" 
                                Margin="-1">
                                <!-- 扩大边界以覆盖内容 -->
                                <Rectangle.Stroke>
                                    <LinearGradientBrush x:Name="FlowBrush" StartPoint="0,0" EndPoint="1,1">
                                        <GradientStop Color="Transparent" Offset="0"/>
                                        <GradientStop Color="Pink" Offset="0.45"/>
                                        <GradientStop Color="DodgerBlue" Offset="0.75"/>
                                        <GradientStop Color="Transparent" Offset="1"/>
                                    </LinearGradientBrush>
                                </Rectangle.Stroke>
                            </Rectangle>
                        </Grid>
                    </GridViewItem>

                </DataTemplate>
            </GridView.ItemTemplate>

            <GridView.ItemContainerStyle>
                <Style TargetType="GridViewItem" BasedOn="{StaticResource DefaultGridViewItemStyle}">
                    <Setter Property="Margin" Value="5,5, 5, 5"/>
                </Style>
            </GridView.ItemContainerStyle>
            <!-- An extra property also needs to be added to the GridView's ItemsWrapGrid.
The following sets the maximum # of items to show before wrapping.-->
            <GridView.ItemsPanel>
                <ItemsPanelTemplate>
                    <ItemsWrapGrid x:Name="MaxItemsWrapGrid"
                       MaximumRowsOrColumns="6"
                       Orientation="Horizontal"/>
                </ItemsPanelTemplate>
            </GridView.ItemsPanel>
        </GridView>

        <!--版本号显示-->
        <Grid 
            Grid.ColumnSpan="2"
            HorizontalAlignment="Center"
            VerticalAlignment="Top">

            <Rectangle
                RadiusX="12"
                RadiusY="12"
                Margin="-12, -8, -12, -8">
                <Rectangle.Fill>
                    <AcrylicBrush
                        TintColor="{ThemeResource SystemChromeLowColor}"
                        TintOpacity="0.7"
                        FallbackColor="{ThemeResource SystemChromeLowColor}"/>
                </Rectangle.Fill>

            </Rectangle>
            <!-- 原来的StackPanel -->
            <StackPanel 
                Orientation="Horizontal">

                <HyperlinkButton
                    x:Name="HyperlinkButton_SSMTVersion"
                    Content="SSMT Version: "
                    ></HyperlinkButton>
                
                
                <HyperlinkButton
                    x:Name="HyperlinkButton_MigotoPackageVersion"
                    Content="3Dmigoto Package Version: "
                    />
            </StackPanel>
        </Grid>


        <!--当前游戏配置-->
        <Border
            Visibility="Collapsed"
            CornerRadius="10"
            x:Name="Border_GameConfig"
            Grid.Column="0" 
            Grid.Row="1"  
            Grid.RowSpan="2"
            Margin="40,50,40,40" >
            
            <Border.Background>
                <AcrylicBrush
                    TintColor="{ThemeResource SystemChromeLowColor}"
                    TintOpacity="0.7"
                    FallbackColor="{ThemeResource SystemChromeLowColor}"/>
            </Border.Background>
            
            <!-- 支持滑条，不然显示不完全 -->
            <ScrollViewer 
                HorizontalAlignment="Stretch"
                HorizontalContentAlignment="Stretch"
                Margin="10"
                VerticalScrollBarVisibility="Auto">
                
                <StackPanel   
                    Orientation="Vertical" 
                    HorizontalAlignment="Stretch">

                    <Expander
                        HorizontalContentAlignment="Stretch"
                        HorizontalAlignment="Stretch"
                        IsExpanded="True">
                        <Expander.Header>
                            <StackPanel Margin="10">
                                <TextBlock 
                                    x:Name="TextBlock_GameName"
                                    FontSize="14" 
                                    FontWeight="Bold" />
                            </StackPanel>
                        </Expander.Header>

                        <StackPanel Orientation="Vertical">
                            <ComboBox
                                HorizontalAlignment="Stretch"
                                Margin="5"
                                x:Name="ComboBox_GameName"
                                SelectionChanged="ComboBox_GameName_SelectionChanged"
                                IsEditable="True">
                            </ComboBox>

                            <StackPanel Orientation="Horizontal">
                                <Button 
                                    Margin="5"
                                    x:Name="Button_CreateNewGame"
                                    Click="Button_CreateNewGame_Click"
                                    >
                                </Button>

                                <Button 
                                    Margin="5"
                                    x:Name="Button_DeleteSelectedGame"
                                    Click="Button_DeleteSelectedGame_Click"
                                    >
                                </Button>
                            </StackPanel>


                            <ComboBox 
                                HorizontalAlignment="Stretch"
                                Margin="5"
                                x:Name="ComboBox_LogicName"
                                SelectionChanged="ComboBox_LogicName_SelectionChanged">
                            </ComboBox>

                            <ComboBox
                                SelectionChanged="ComboBox_GameTypeFolder_SelectionChanged"
                                HorizontalAlignment="Stretch"
                                Margin="5"
                                x:Name="ComboBox_GameTypeFolder"
                                >
                                
                            </ComboBox>
                            
                            <StackPanel Orientation="Horizontal">
                                <Button
                                    Click="Button_CheckBGUpdate_Click"
                                    Style="{StaticResource AccentButtonStyle}"
                                    Margin="5"
                                    x:Name="Button_AutoUpdateBackground"
                                    />
                                <Button
                                    Click="Button_SelectBackgroundFile_Click"
                                    x:Name="Button_SelectBackgroundFile"
                                    Margin="5"/>
                                
                                <Button
                                    Click="Button_ChooseGameIcon_Click"
                                    Margin="5"
                                    x:Name="Button_ChooseGameIcon"
                                    />
                                
                                <ToggleSwitch
                                    Toggled="ToggleSwitch_ShowIcon_Toggled"
                                    Margin="5"
                                    x:Name="ToggleSwitch_ShowIcon"
                                    >
                                </ToggleSwitch>

                                
                            </StackPanel>
                            
                        </StackPanel>
                    </Expander>
                   
                    <Expander
                        HorizontalContentAlignment="Stretch"
                        HorizontalAlignment="Stretch"
                        IsExpanded="True">
                        <Expander.Header>
                            <StackPanel Margin="10">
                                <TextBlock 
                                    x:Name="TextBlock_3DmigotoFolderPath"
                                    FontSize="14" 
                                    FontWeight="Bold"/>
                            </StackPanel>
                        </Expander.Header>

                        <StackPanel Orientation="Vertical">
                            <TextBox 
                                HorizontalAlignment="Stretch"
                                Margin="5"
                                LostFocus="TextBox_3DmigotoPath_LostFocus"
                                x:Name="TextBox_3DmigotoPath"  />

                            <StackPanel Orientation="Horizontal">
                                <Button 
                                    Margin="5"
                                    VerticalAlignment="Center" 
                                    Click="Button_Choose3DmigotoPath_Click"
                                    x:Name="Button_Choose3DmigotoPath"/>
                                <Button
                                    Margin="5"
                                    x:Name="Button_Open3DmigotoFolder"
                                    Click="Button_Open3DmigotoFolder_Click"/>
                            </StackPanel>
                            
                            
                            <StackPanel Orientation="Horizontal">
                                <Button 
                                    Margin="5"
                                    Style="{StaticResource AccentButtonStyle}"
                                    x:Name="Button_CheckMigotoPackageUpdate"
                                    Click="Button_CheckMigotoPackageUpdate_Click"
                                    >
                                </Button>

                                <ProgressRing 
                                    Margin="5"
                                    x:Name="ProgressRing_PackageUpdateRing" 
                                    IsActive="False">
                                </ProgressRing>

                            </StackPanel>

                            <TextBox 
                                HorizontalAlignment="Stretch"
                                Margin="5"
                                LostFocus="TextBox_TargetPath_LostFocus"
                                x:Name="TextBox_TargetPath"/>

                            <Button 
                                Margin="5"
                                Click="Button_ChooseProcessFile_Click"
                                x:Name="Button_ChooseProcessFile"
                                VerticalAlignment="Center"/>


                            <TextBox 
                                Margin="5"
                                HorizontalAlignment="Stretch"
                                LostFocus="TextBox_LaunchPath_LostFocus"
                                x:Name="TextBox_LaunchPath"/>

                            <Button 
                                Margin="5"
                                Click="Button_ChooseLaunchFile_Click"
                                x:Name="Button_ChooseLaunchFile"
                                VerticalAlignment="Center"/>

                            <TextBox 
                                Margin="5"
                                LostFocus="TextBox_LaunchArgsPath_LostFocus"
                                MinWidth="200"
                                x:Name="TextBox_LaunchArgsPath"/>


                            <StackPanel Orientation="Horizontal">
                                <ToggleSwitch 
                                    Margin="5"
                                    VerticalAlignment="Center" 
                                    x:Name="ToggleSwitch_Symlink" 
                                    Toggled="ToggleSwitch_Symlink_Toggled"/>

                                <ToggleSwitch
                                    Margin="5"
                                    x:Name="ToggleSwitch_AutoSetAnalyseOptions"  
                                    Toggled="ToggleSwitch_AutoSetAnalyseOptions_Toggled"
                                    />

                            </StackPanel>

                            <StackPanel Orientation="Horizontal">

                                <ToggleSwitch 
                                    VerticalAlignment="Center" 
                                    Margin="5" 
                                    x:Name="ToggleSwitch_ShowWarning" 
                                    Toggled="ToggleSwitch_ShowWarning_Toggled"
                                    ToolTipService.ToolTip=""/>
                                
                                <ToggleSwitch 
                                    Margin="5"
                                    x:Name="ToggleSwitch_DllMode"
                                    Toggled="ToggleSwitch_DllMode_Toggled"
                                    />

                            </StackPanel>

                            <NumberBox 
                                HorizontalAlignment="Left"
                                Width="200"
                                Margin="5"
                                SmallChange="10"
                                LargeChange="100"
                                x:Name="NumberBox_DllInitializationDelay"
                                LostFocus="NumberBox_DllInitializationDelay_LostFocus"
                                ></NumberBox>
                            
                        </StackPanel>

                    </Expander>

                    <StackPanel
                        x:Name="StackPanel_GIError"
                        Orientation="Vertical"
                        >
                        <Expander
                            HorizontalContentAlignment="Stretch"
                            HorizontalAlignment="Stretch"
                            IsExpanded="True">
                            <Expander.Header>
                                <StackPanel Margin="10">
                                    <TextBlock 
                                        ToolTipService.ToolTip="清理本地缓存日志，以避免由于缓存日志导致标记重点扫描从而更容易出现【与服务器的连接已断开】的问题"
                                        Text="某游戏Mod防报错措施" 
                                        FontSize="14" 
                                        FontWeight="Bold" />
                                </StackPanel>
                            </Expander.Header>

                            <StackPanel Orientation="Horizontal">
                                <Button
                                   Click="Button_CleanGICache_Click"
                                   x:Name="Button_CleanGICache"
                                   Margin="5"
                                   Content="清理缓存日志"></Button>

                                <Button
                                    ToolTipService.ToolTip="开启后，使用SSMT启动游戏使用Mod将可以避免由于Mod导致的网络卡顿而出现的【与服务器的连接已断开】错误弹窗"
                                    Click="Button_RunIgnoreGIError40_Click"
                                    x:Name="Button_RunIgnoreGIError40"
                                    Margin="5"
                                    Content="启动第四代防报错技术: 网络加固插件"></Button>

                                <ToggleSwitch 
                                    IsOn="True"
                                    Margin="5"
                                    ToolTipService.ToolTip="开启后，Mod全程仅使用SSMT的情况下不会出现【与服务器的连接已断开】问题，使用此方法前建议清理缓存并关闭其它所有第三方工具然后重启电脑，确保环境纯净。"
                                    x:Name="ToggleSwitch_IgnoreGIError25"
                                    OffContent="当前不开启2.5代防报错"
                                    OnContent="当前开启2.5代防报错"/>
                            </StackPanel>
                            
                        </Expander>

                    </StackPanel>
                   
                </StackPanel>
            </ScrollViewer>
        </Border>
   
        
        <!--一键启动按钮和设置按钮-->
        <StackPanel
            Grid.Column="0"
            Grid.ColumnSpan="2"
            Grid.Row="0"
            Grid.RowSpan="2"
            Margin="0,0,25,25" 
            VerticalAlignment="Bottom"
            HorizontalAlignment="Right"
            Orientation="Horizontal">

            <!--一键启动按钮-->
            <StackPanel 
                Margin="15"
                Orientation="Vertical">

                <StackPanel Orientation="Horizontal">

                    <StackPanel Orientation="Vertical">
                        <Border
                            CornerRadius="25"
                            Width="Auto"
                            Margin="5"
                            BorderThickness="2"
                            BorderBrush="White"
                            >
                            <Button 
                                BorderThickness="0"
                                x:Name="Button_Run3DmigotoLoader" 
                                Width="200"
                                MinHeight="50"
                                FontSize="21"
                                FontWeight="Bold"
                                Click="Open3DmigotoLoaderExe"/>
                        </Border>
                        <Border
                            CornerRadius="25"
                            Width="Auto"
                            Margin="5"
                            BorderThickness="2"
                            BorderBrush="White"
                            >
                            <Button 
                                BorderThickness="0"
                                x:Name="Button_RunLaunchPath" 
                                Width="200"
                                MinHeight="50"
                                FontSize="21"
                                FontWeight="Bold"
                                Click="Button_RunLaunchPath_Click"
                                HorizontalContentAlignment="Center"
                                VerticalContentAlignment="Center"/>
                        </Border>



                    </StackPanel>


                    <Button 
                        VerticalAlignment="Bottom"
                            Margin="5"
                            x:Name="Button_ShowSetting"
                            Click="Button_ShowSetting_Click"
                            CornerRadius="25,25,25,25"
                            Width="45" 
                            Height="45">
                        <SymbolIcon Symbol="Setting"/>
                    </Button>

                </StackPanel>
                

            </StackPanel>



        </StackPanel>
        
       
    </Grid>
        
</Page>

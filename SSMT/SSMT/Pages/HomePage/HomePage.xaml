<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="SSMT.HomePage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:SSMT"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    xmlns:mmt_core_gridviewitems="using:SSMT"
    xmlns:community="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:s="using:CommunityToolkit.WinUI"
    xmlns:controls="using:CommunityToolkit.WinUI.Controls"
    xmlns:canvas="using:Microsoft.Graphics.Canvas.UI.Xaml"
    CacheMode="BitmapCache"
    Background="Transparent"
    >

    <Grid >
        <!-- 定义行 -->
        <Grid.RowDefinitions>
            <RowDefinition/>
        </Grid.RowDefinitions>

        <!-- 定义列 -->
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="0.7*"/>
            <ColumnDefinition Width="0.3*"/>
        </Grid.ColumnDefinitions>

        <!-- 背景视频 -->
        <MediaPlayerElement 
            x:Name="BackgroundVideo"
            Grid.ColumnSpan="2"
            Grid.RowSpan="2"
            AreTransportControlsEnabled="False"
            AutoPlay="False"
            IsHitTestVisible="False"
            Stretch="UniformToFill"
            Visibility="Collapsed" />

        <!-- 背景图片 -->
        <Image 
            HorizontalAlignment="Right"
            RenderTransformOrigin="0.5,0.5"
            Grid.ColumnSpan="2"
            Grid.RowSpan="2"
            x:Name="MainWindowImageBrush"  
            Stretch="UniformToFill" >
            <Image.RenderTransform>
                <ScaleTransform />
            </Image.RenderTransform>
        </Image>

        <!--游戏图标列表-->
        <GridView
            Margin="80,35"
            VerticalAlignment="Bottom"
            Grid.Column="0"
            Grid.Row="0"
            x:Name="GameIconGridView"
            ScrollViewer.VerticalScrollBarVisibility="Auto"
            MaxWidth="1000"
            SelectionChanged="GameIconGridView_SelectionChanged">

            <GridView.ItemTemplate >
                <DataTemplate x:Name="GameIconItemGridTemplate" x:DataType="local:GameIconItem" >
                    <GridViewItem >
                        <Grid x:Name="ModShowGrid" Width="80" Height="80" AllowDrop="False" >

                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>


                            <Image HorizontalAlignment="Left"   Grid.Row="0" Source="{x:Bind GameIconImage}" Stretch="UniformToFill" Width="80" Height="80"/>

                            <StackPanel Grid.Row="0" Orientation="Vertical" VerticalAlignment="Bottom" Height="20" >
                                <StackPanel.Background>
                                    <AcrylicBrush
                                        TintColor="{ThemeResource SystemChromeLowColor}"
                                        TintOpacity="0.7"
                                        FallbackColor="{ThemeResource SystemChromeLowColor}"/>
                                </StackPanel.Background>
                                <TextBlock 
                                    HorizontalAlignment="Center" Margin="1" VerticalAlignment="Bottom" Text="{x:Bind GameName}" FontSize="11" FontWeight="Bold"/>
                            </StackPanel>
                            <!-- 流光边框 -->
                            <Rectangle 
                                Grid.Row="0" 
                                Grid.RowSpan="2" 
                                x:Name="FlowBorder" 
                                RadiusX="8" 
                                RadiusY="8" 
                                StrokeThickness="2" 
                                Margin="-1">
                                <!-- 扩大边界以覆盖内容 -->
                                <Rectangle.Stroke>
                                    <LinearGradientBrush x:Name="FlowBrush" StartPoint="0,0" EndPoint="1,1">
                                        <GradientStop Color="Transparent" Offset="0"/>
                                        <GradientStop Color="Pink" Offset="0.45"/>
                                        <GradientStop Color="DodgerBlue" Offset="0.75"/>
                                        <GradientStop Color="Transparent" Offset="1"/>
                                    </LinearGradientBrush>
                                </Rectangle.Stroke>
                            </Rectangle>
                        </Grid>
                    </GridViewItem>

                </DataTemplate>
            </GridView.ItemTemplate>

            <GridView.ItemContainerStyle>
                <Style TargetType="GridViewItem" BasedOn="{StaticResource DefaultGridViewItemStyle}">
                    <Setter Property="Margin" Value="5,5, 5, 5"/>
                </Style>
            </GridView.ItemContainerStyle>
            <!-- An extra property also needs to be added to the GridView's ItemsWrapGrid.
The following sets the maximum # of items to show before wrapping.-->
            <GridView.ItemsPanel>
                <ItemsPanelTemplate>
                    <ItemsWrapGrid x:Name="MaxItemsWrapGrid"
                       MaximumRowsOrColumns="6"
                       Orientation="Horizontal"/>
                </ItemsPanelTemplate>
            </GridView.ItemsPanel>
        </GridView>




        <!--当前游戏配置-->
        <Border
            Visibility="Collapsed"
            CornerRadius="10"
            x:Name="Border_GameConfig"
            Grid.Column="0" 
            Grid.Row="1"  
            Grid.RowSpan="2"
            Margin="40" >
            
            <Border.Background>
                <AcrylicBrush
                    TintColor="{ThemeResource SystemChromeLowColor}"
                    TintOpacity="0.7"
                    FallbackColor="{ThemeResource SystemChromeLowColor}"/>
            </Border.Background>
            
            <!-- 支持滑条，不然显示不完全 -->
            <ScrollViewer 
                HorizontalAlignment="Stretch"
                HorizontalContentAlignment="Stretch"
                Margin="10"
                VerticalScrollBarVisibility="Auto">
                
                <StackPanel   
                    Orientation="Vertical" 
                    HorizontalAlignment="Stretch">

                    <Expander
                        HorizontalContentAlignment="Stretch"
                        HorizontalAlignment="Stretch"
                        IsExpanded="True">
                        <Expander.Header>
                            <StackPanel Margin="10">
                                <TextBlock 
                                    x:Name="TextBlock_GameName"
                                    FontSize="14" 
                                    FontWeight="Bold" />
                            </StackPanel>
                        </Expander.Header>

                        <StackPanel Orientation="Vertical">
                            <ComboBox
                                HorizontalAlignment="Stretch"
                                Margin="5"
                                x:Name="ComboBox_GameName"
                                SelectionChanged="ComboBox_GameName_SelectionChanged"
                                IsEditable="True">
                            </ComboBox>

                            <StackPanel Orientation="Horizontal">
                                <Button 
                                    Margin="5"
                                    x:Name="Button_CreateNewGame"
                                    Click="Button_CreateNewGame_Click"
                                    >
                                </Button>

                                <Button 
                                    Margin="5"
                                    x:Name="Button_DeleteSelectedGame"
                                    Click="Button_DeleteSelectedGame_Click"
                                    >
                                </Button>
                            </StackPanel>


                            <ComboBox 
                                HorizontalAlignment="Stretch"
                                Margin="5"
                                x:Name="ComboBox_LogicName"
                                SelectionChanged="ComboBox_LogicName_SelectionChanged">
                            </ComboBox>

                            <ComboBox
                                SelectionChanged="ComboBox_GameTypeFolder_SelectionChanged"
                                HorizontalAlignment="Stretch"
                                Margin="5"
                                x:Name="ComboBox_GameTypeFolder"
                                >
                                
                            </ComboBox>
                            
                            <StackPanel Orientation="Horizontal">
                                <Button
                                    Click="Button_CheckBGUpdate_Click"
                                    Style="{StaticResource AccentButtonStyle}"
                                    Margin="5"
                                    x:Name="Button_AutoUpdateBackground"
                                    />
                                <Button
                                    Click="Button_SelectBackgroundFile_Click"
                                    x:Name="Button_SelectBackgroundFile"
                                    Margin="5"/>
                                
                                <Button
                                    Click="Button_ChooseGameIcon_Click"
                                    Margin="5"
                                    x:Name="Button_ChooseGameIcon"
                                    />
                                
                                <ToggleSwitch
                                    Toggled="ToggleSwitch_ShowIcon_Toggled"
                                    Margin="5"
                                    x:Name="ToggleSwitch_ShowIcon"
                                    >
                                </ToggleSwitch>

                                
                            </StackPanel>
                            
                        </StackPanel>
                    </Expander>
                   
                    <Expander
                        HorizontalContentAlignment="Stretch"
                        HorizontalAlignment="Stretch"
                        IsExpanded="True">
                        <Expander.Header>
                            <StackPanel Margin="10">
                                <TextBlock 
                                    x:Name="TextBlock_3DmigotoFolderPath"
                                    FontSize="14" 
                                    FontWeight="Bold"/>
                            </StackPanel>
                        </Expander.Header>

                        <StackPanel Orientation="Vertical">
                            <TextBox 
                                HorizontalAlignment="Stretch"
                                Margin="5"
                                LostFocus="TextBox_3DmigotoPath_LostFocus"
                                x:Name="TextBox_3DmigotoPath"  />

                            <StackPanel Orientation="Horizontal">
                                <Button 
                                    Margin="5"
                                    VerticalAlignment="Center" 
                                    Click="Button_Choose3DmigotoPath_Click"
                                    x:Name="Button_Choose3DmigotoPath"/>
                                <Button
                                    Margin="5"
                                    x:Name="Button_Open3DmigotoFolder"
                                    Click="Button_Open3DmigotoFolder_Click"/>

                                <HyperlinkButton
                                    Margin="5"
                                    x:Name="HyperlinkButton_MigotoPackageVersion"
                                    Content="3Dmigoto Package Version: "
                                    />
                            </StackPanel>
                            
                            
                            <StackPanel Orientation="Horizontal">
                                <Button 
                                    Margin="5"
                                    Style="{StaticResource AccentButtonStyle}"
                                    x:Name="Button_CheckMigotoPackageUpdate"
                                    Click="Button_CheckMigotoPackageUpdate_Click"
                                    >
                                </Button>

                                <ProgressRing 
                                    Margin="5"
                                    x:Name="ProgressRing_PackageUpdateRing" 
                                    IsActive="False">
                                </ProgressRing>

                            </StackPanel>

                            <TextBox 
                                HorizontalAlignment="Stretch"
                                Margin="5"
                                LostFocus="TextBox_TargetPath_LostFocus"
                                x:Name="TextBox_TargetPath"/>

                            <Button 
                                Margin="5"
                                Click="Button_ChooseProcessFile_Click"
                                x:Name="Button_ChooseProcessFile"
                                VerticalAlignment="Center"/>


                            <TextBox 
                                Margin="5"
                                HorizontalAlignment="Stretch"
                                LostFocus="TextBox_LaunchPath_LostFocus"
                                x:Name="TextBox_LaunchPath"/>

                            <Button 
                                Margin="5"
                                Click="Button_ChooseLaunchFile_Click"
                                x:Name="Button_ChooseLaunchFile"
                                VerticalAlignment="Center"/>

                            <TextBox 
                                Margin="5"
                                LostFocus="TextBox_LaunchArgsPath_LostFocus"
                                MinWidth="200"
                                x:Name="TextBox_LaunchArgsPath"/>


                            <StackPanel Orientation="Horizontal">
                                <ToggleSwitch 
                                    Margin="5"
                                    VerticalAlignment="Center" 
                                    x:Name="ToggleSwitch_Symlink" 
                                    Toggled="ToggleSwitch_Symlink_Toggled"/>

                                <ToggleSwitch
                                    Margin="5"
                                    x:Name="ToggleSwitch_AutoSetAnalyseOptions"  
                                    Toggled="ToggleSwitch_AutoSetAnalyseOptions_Toggled"
                                    />

                            </StackPanel>

                            <StackPanel Orientation="Horizontal">

                                <ToggleSwitch 
                                    VerticalAlignment="Center" 
                                    Margin="5" 
                                    x:Name="ToggleSwitch_ShowWarning" 
                                    Toggled="ToggleSwitch_ShowWarning_Toggled"
                                    ToolTipService.ToolTip=""/>
                                
                                

                            </StackPanel>

                            <NumberBox 
                                HorizontalAlignment="Left"
                                Width="200"
                                Margin="5"
                                SmallChange="10"
                                LargeChange="100"
                                x:Name="NumberBox_DllInitializationDelay"
                                LostFocus="NumberBox_DllInitializationDelay_LostFocus"
                                ></NumberBox>

                            

                        </StackPanel>

                    </Expander>


                    <controls:SettingsExpander 
                        x:Name="SettingsExpander_DllRelatedSettings"
                        IsExpanded="True"
                        VerticalAlignment="Top">

                        <controls:SettingsExpander.Items>

                            <controls:SettingsCard 
                                x:Name="SettingsCard_DllReplace"
                                Description=""
                                Header="">
                                <controls:SettingsCard.HeaderIcon>
                                    <FontIcon Glyph="&#xEfa5;" FontFamily="Segoe Fluent Icons"/>
                                </controls:SettingsCard.HeaderIcon>

                                <ComboBox 
                                    SelectionChanged="ComboBox_DllReplace_SelectionChanged"
                                    x:Name="ComboBox_DllReplace" 
                                    >
                                    <ComboBoxItem x:Name="ComboBoxItem_DllReplace_Dev" />
                                    <ComboBoxItem x:Name="ComboBoxItem_DllReplace_Play" />
                                    <ComboBoxItem x:Name="ComboBoxItem_DllReplace_None" />
                                </ComboBox>


                            </controls:SettingsCard>


                            <controls:SettingsCard x:Name="SettingsCard_DllPreProcess">

                                <!-- 这里换成你查到的编码 -->
                                <controls:SettingsCard.HeaderIcon>
                                    <FontIcon Glyph="&#xE745;"     
                                        FontFamily="Segoe Fluent Icons"/>
                                </controls:SettingsCard.HeaderIcon>

                                <ComboBox 
                                    SelectionChanged="ComboBox_DllPreProcess_SelectionChanged"
                                    
                                    x:Name="ComboBox_DllPreProcess">
                                    <ComboBoxItem x:Name="ComboBox_DllPreProcess_None" />
                                    <ComboBoxItem x:Name="ComboBox_DllPreProcess_PackWithUPX" />
                                </ComboBox>

                            </controls:SettingsCard>

                        </controls:SettingsExpander.Items>
                    </controls:SettingsExpander>


                    <StackPanel
                        x:Name="StackPanel_GIError"
                        Orientation="Vertical"
                        >
                        <Expander
                            HorizontalContentAlignment="Stretch"
                            HorizontalAlignment="Stretch"
                            IsExpanded="True">
                            <Expander.Header>
                                <StackPanel Margin="10">
                                    <TextBlock 
                                        x:Name="TextBlock_ClearGICache"
                                        FontSize="14" 
                                        FontWeight="Bold" />
                                </StackPanel>
                            </Expander.Header>

                            <StackPanel Orientation="Horizontal">
                                <Button
                                   Click="Button_CleanGICache_Click"
                                   x:Name="Button_CleanGICache"
                                   Margin="5"/>

                                <Button
                                    Click="Button_RunIgnoreGIError40_Click"
                                    x:Name="Button_RunIgnoreGIError40"
                                    Margin="5"
                                    ></Button>

                                
                            </StackPanel>
                            
                        </Expander>

                    </StackPanel>
                   
                </StackPanel>
            </ScrollViewer>
        </Border>
   
        
        <!--一键启动按钮和设置按钮-->
        <StackPanel
            Grid.Column="0"
            Grid.ColumnSpan="2"
            Grid.Row="0"
            Grid.RowSpan="2"
            Margin="0,0,25,25" 
            VerticalAlignment="Bottom"
            HorizontalAlignment="Right"
            Orientation="Horizontal">

            <!--一键启动按钮-->
            <StackPanel 
                Margin="15"
                Orientation="Vertical">

                <StackPanel Orientation="Horizontal">

                    <StackPanel Orientation="Vertical">
                        <Grid>
                            

                            <Border
                                CornerRadius="25"
                                Width="Auto"
                                Margin="5"
                                BorderThickness="2"
                                BorderBrush="White"
                                >

                                <Grid>
                                    <!-- Glow 层 -->
                                    <canvas:CanvasControl x:Name="GlowCanvas"
                                        Width="200" MinHeight="50"
                                        ClearColor="Transparent"
                                        CreateResources="GlowCanvas_CreateResources"
                                        Draw="GlowCanvas_Draw"/>
                                    <Button 
                                        BorderThickness="0"
                                        x:Name="Button_Run3DmigotoLoader" 
                                        Width="200"
                                        MinHeight="50"
                                        FontSize="21"
                                        FontWeight="Bold"
                                        PointerExited="GlowButton_PointerExited"
                                        PointerEntered="GlowButton_PointerEntered"
                                        Click="Open3DmigotoLoaderExe"/>
                                </Grid>

                                
                            </Border>
                        </Grid>
                        
                        <Border
                            CornerRadius="25"
                            Width="Auto"
                            Margin="5"
                            BorderThickness="2"
                            BorderBrush="White"
                            >
                            <Button 
                                BorderThickness="0"
                                x:Name="Button_RunLaunchPath" 
                                Width="200"
                                MinHeight="50"
                                FontSize="21"
                                FontWeight="Bold"
                                Click="Button_RunLaunchPath_Click"
                                HorizontalContentAlignment="Center"
                                VerticalContentAlignment="Center"/>
                        </Border>



                    </StackPanel>


                    <Button 
                        VerticalAlignment="Bottom"
                            Margin="5"
                            x:Name="Button_ShowSetting"
                            Click="Button_ShowSetting_Click"
                            CornerRadius="25,25,25,25"
                            Width="45" 
                            Height="45">
                        <SymbolIcon Symbol="Setting"/>
                    </Button>

                </StackPanel>
                

            </StackPanel>



        </StackPanel>
        
       
    </Grid>
        
</Page>
